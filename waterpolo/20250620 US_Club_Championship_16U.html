<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 U16 Boys Water Polo US Club Championship</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Floating Back Button -->
    <a href="index.html" class="floating-back-btn" id="floatingBackBtn">
        <img src="https://sdshores.org/sites/all/themes/jango/jango_sub/logo.png" alt="SD Shores Logo" />
    </a>
    <div class="hero">
        <h1>üèÜ 2025 U16 Boys Water Polo</h1>
        <p class="subtitle">US Club Championship</p>
        <div class="memorial">
            <p><strong>June 20-22, 2025</strong></p>
            <p><a href="pools.html#riverside-poly">Riverside Poly</a> ‚Ä¢ <a href="pools.html#ramona">Ramona HS</a> ‚Ä¢ <a href="pools.html#norco">Norco HS</a> ‚Ä¢ <a href="pools.html#chino-hills">Chino Hills HS</a></p>
        </div>
    </div>

    <div class="container">

        <!-- Tournament Information -->
        <div class="content-section">
            <button class="collapsible">üìã Tournament Information</button>
            <div class="collapsible-content">
                <div class="tournament-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="team-count">16</div>
                        <div class="stat-label">Teams</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="match-count">39</div>
                        <div class="stat-label">Matches</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="venue-count">4</div>
                        <div class="stat-label">Venues</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">3</div>
                        <div class="stat-label">Days</div>
                    </div>
                </div>
                <div class="memorial-story">
                    <h3>üèÜ US Club Championship Tournament</h3>
                    <p>The premier 16U Boys Water Polo championship tournament featuring 16 elite teams competing across four pools (A, B, C, D) in a comprehensive bracket format. Teams advance through pool play into crossover elimination rounds, culminating in placement matches that determine final tournament standings.</p>
                    <p>This prestigious tournament showcases the finest youth water polo talent from across the region, with matches held at premier aquatic facilities throughout Southern California over three competitive days.</p>
                </div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            üèä‚Äç‚ôÇÔ∏è Loading tournament data...
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <!-- Pools Section -->
        <div class="content-section">
            <div class="section-header">üèä‚Äç‚ôÇÔ∏è Tournament Pools</div>
            <div class="section-content">
                <div class="standings-grid" id="pools-container">
                    <!-- Pools will be populated here -->
                </div>
            </div>
        </div>

        <!-- All Tournament Matches -->
        <div class="content-section">
            <div class="section-header">üìÖ All Tournament Matches - Complete Schedule</div>
            <div class="section-content">
                <div style="overflow-x: auto; margin-top: 20px;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #0077be 0%, #00a8cc 100%); color: white;">
                                <th style="padding: 12px 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">Game</th>
                                <th style="padding: 12px 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">Date</th>
                                <th style="padding: 12px 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">Time</th>
                                <th style="padding: 12px 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">Venue</th>
                                <th style="padding: 12px 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">Team 1</th>
                                <th style="padding: 12px 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">Score</th>
                                <th style="padding: 12px 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">Team 2</th>
                                <th style="padding: 12px 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">Phase/Bracket</th>
                                <th style="padding: 12px 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="matches-tbody">
                            <!-- Matches will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Data Source -->
        <div class="content-section">
            <div class="section-content">
                <div class="data-source">
                    <h4>üìä Data Source</h4>
                    <p>Tournament schedules, results and live match updates from official scoresheet:</p>
                    <a href="https://docs.google.com/spreadsheets/d/1FuCUomKqgfg8d83zYxld0B2mnTmcbefwyxKFEebMgiY/edit?gid=0#gid=0" target="_blank" rel="noopener noreferrer">
                        View Official Tournament Scoresheet - US Club Championship 16U
                    </a>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                        <strong>Note:</strong> Match scores and results are updated live in the Google Sheet. 
                        Website data is embedded and requires manual updates from the live sheet.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <p><strong>2025 U16 Boys Water Polo - US Club Championship</strong></p>
            <p>June 20-22, 2025 ‚Ä¢ <a href="pools.html#riverside-poly">Riverside Poly</a> ‚Ä¢ <a href="pools.html#ramona">Ramona HS</a> ‚Ä¢ <a href="pools.html#norco">Norco HS</a> ‚Ä¢ <a href="pools.html#chino-hills">Chino Hills HS</a> ‚Ä¢ California</p>
            <p>Building champions through competition and teamwork üèÜ</p>
        </div>
    </div>

    <script>
        // Tournament data (embedded to work within CSP constraints)
        // To connect to live Google Sheets, replace this with:
        // const CSV_URL = 'https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=csv&gid=0';
        // and use fetch(CSV_URL) in loadTournamentData()
        
        const csvData = `DATE,LOCATION,TIME,WHITE TEAM,S,DARK TEAM,S,COMMENTS
6/20/2025,RIVERSIDE POLY #1,4:30 PM,D1 - THUNDER,10,D4 - KERN PREMIER,11,bracket
6/20/2025,RIVERSIDE POLY #1,5:30 PM,B2 - ROSE BOWL,8,B3 -  SD SHORES GOLD,14,bracket
6/20/2025,RIVERSIDE POLY #1,6:30 PM,C1 - CARLSBAD,8,C3 - CLOVIS,14,bracket
6/20/2025,RIVERSIDE POLY #1,7:30 PM,D2 - COMMERCE,14,D4 - KERN PREMIER,9,bracket
6/20/2025,RAMONA HS,4:30 PM,D2 - COMMERCE,8,D3 - SUPREME,12,bracket
6/20/2025,RAMONA HS,5:30 PM,A2 - POWAY VALLEY,9,A3 - SOCAL,12,bracket
6/20/2025,RAMONA HS,6:30 PM,C2 - CHAWP,10,C4 - TEMPLE CITY,4,bracket
6/20/2025,RAMONA HS,7:30 PM,D1 - THUNDER,13,D3 - SUPREME,14,bracket
6/20/2025,NORCO HS,10:00 AM,C1 - CARLSBAD,10,C4 - TEMPLE CITY,12,bracket
6/20/2025,NORCO HS,11:00 AM,C2 - CHAWP,8,C3 - CLOVIS,6,bracket
6/21/2025,RIVERSIDE POLY #1,9:00 AM,A1 - SD SHORES BLACK,18,A2 - POWAY VALLEY,9,
6/21/2025,RIVERSIDE POLY #1,11:00 AM,A1 - SD SHORES BLACK,18,A3 - SOCAL,6,
6/21/2025,RIVERSIDE POLY #1,12:00 PM,C1 - CARLSBAD,4,C2 - CHAWP,14,
6/21/2025,RIVERSIDE POLY #1,1:00 PM,C3 - CLOVIS,11,C4 - TEMPLE CITY,8,
6/21/2025,RIVERSIDE POLY #1,2:00 PM,E1 -1st A - SD SHORES BLACK,15,E2 - 2nd B - ROSE BOWL,5,
6/21/2025,RIVERSIDE POLY #1,3:00 PM,K1- 3rd B - NORTH IRVINE,,K3 - 4th D - THUNDER,,
6/21/2025,RIVERSIDE POLY #1,4:00 PM,H1 - 1st D - SUPREME,,H2 - 2nd C - CLOVIS,,
6/21/2025,RIVERSIDE POLY #1,5:00 PM,K1- 3rd B - NORTH IRVINE,,K2 - 3rd C - TEMPLE CITY,,
6/21/2025,RAMONA HS,9:00 AM,B1 - NORTH IRVINE,6,B3 -  SD SHORES GOLD,14,
6/21/2025,RAMONA HS,11:00 AM,B1 - NORTH IRVINE,7,B2 - ROSE BOWL,10,
6/21/2025,RAMONA HS,12:00 PM,D3 - SUPREME,12,D4 - KERN PREMIER,7,
6/21/2025,RAMONA HS,1:00 PM,D1 - THUNDER,9,D2 - COMMERCE,15,
6/21/2025,RAMONA HS,2:00 PM,F1 -1st B - SD SHORES GOLD,11,F2 -2nd A - SOCAL,14,
6/21/2025,RAMONA HS,3:00 PM,J1- 3rd A - POWAY VALLEY,,J2 - 3rd D -  KERN PREMIER,,
6/21/2025,RAMONA HS,4:00 PM,G1 - 1st C - CHAWP,,G2 - 2nd D - COMMERCE,,
6/21/2025,RAMONA HS,5:00 PM,J1- 3rd A - POWAY VALLEY,,J3 - 4th C - CARLSBAD,,
6/22/2025,RIVERSIDE POLY #1,8:00 AM,M1 - 1st E - SD SHORES BLACK,,M2 - 1st H - ,,
6/22/2025,RIVERSIDE POLY #1,9:00 AM,N1 - 1st F - SOCAL,,N2 - 1st G - ,,
6/22/2025,RIVERSIDE POLY #1,11:00 AM,P1 - 2nd F - SD SHORES GOLD,,P2 - 2nd G - ,,
6/22/2025,RIVERSIDE POLY #1,12:00 PM,O1 - 2nd E - ROSE BOWL,,O2 - 2nd H - ,,
6/22/2025,RIVERSIDE POLY #1,2:00 PM,X1 - 2nd O - ,,X2 - 2nd P - ,,7th
6/22/2025,RIVERSIDE POLY #1,3:00 PM,W1 - 1st O - ,,W2 - 1st P -,,5th
6/22/2025,RAMONA HS,8:00 AM,K2 - 3rd C - TEMPLE CITY,,K3 - 4th D - THUNDER,,
6/22/2025,RAMONA HS,9:00 AM,J2 - 3rd D -  KERN PREMIER,,J3 - 4th C - CARLSBAD,,
6/22/2025,RAMONA HS,11:00 AM,R1 - 3rd J,,R2 - 3td K,,13th
6/22/2025,RAMONA HS,12:00 PM,Q1 - 1st J - ,,Q2 - 1st K - ,,9th
6/22/2025,RAMONA HS,2:00 PM,S1 - 2nd J - ,,S2 - 2nd K - ,,11th
6/22/2025,CHINO HILLS HS,1:00 PM,V1 - 2nd M -,,V2 - 2nd N - ,,3rd
6/22/2025,CHINO HILLS HS,2:00 PM,U1 - 1st M - ,,U2 - 1st N - ,,1st`;
        
        let tournamentData = {};


        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length >= headers.length) {
                        const row = {};
                        headers.forEach((header, index) => {
                            // Handle duplicate 'S' column names by making them unique
                            if (header === 'S' && row.hasOwnProperty('S')) {
                                row['S2'] = values[index] || '';
                            } else {
                                row[header] = values[index] || '';
                            }
                        });
                        data.push(row);
                    }
                }
            }
            return data;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"' && (i === 0 || line[i-1] === ',')) {
                    inQuotes = true;
                } else if (char === '"' && inQuotes) {
                    inQuotes = false;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        // Clean team name (extract code and name)
        function cleanTeamName(teamName) {
            if (!teamName || teamName.trim() === '') {
                return { code: "", name: "" };
            }
            
            const match = teamName.trim().match(/^([A-Z0-9]+(?:\s*-\s*\w+)*)\s*-\s*(.+)$/);
            if (match) {
                return { code: match[1].trim(), name: match[2].trim().replace(/\s+/g, ' ') };
            }
            return { code: "", name: teamName.trim() };
        }

        // Determine match phase
        function determineMatchPhase(comments, whiteTeam, darkTeam) {
            const commentsLower = comments.toLowerCase();
            if (commentsLower.includes('bracket')) return "Pool Play";
            if (['1st', '2nd', '3rd', '4th'].some(term => commentsLower.includes(term))) return "Crossover";
            if (commentsLower.includes('final') || ['1st', '3rd', '5th', '7th', '9th', '11th', '13th', '15th'].some(term => comments.includes(term))) return "Finals";
            if (['A1', 'A2', 'A3', 'A4', 'B1', 'B2', 'B3', 'B4', 'C1', 'C2', 'C3', 'C4', 'D1', 'D2', 'D3', 'D4'].some(code => 
                whiteTeam.includes(code) || darkTeam.includes(code))) return "Pool Play";
            return "Bracket Play";
        }

        // Process tournament data
        function processTournamentData(csvData) {
            const matches = [];
            const allTeams = new Set();
            const venues = new Set();

            csvData.forEach((row, index) => {
                if (!row.DATE || row.DATE.trim() === '' || row.DATE.includes('DATE')) return;
                
                const whiteTeamRaw = (row['WHITE TEAM'] || '').trim();
                const darkTeamRaw = (row['DARK TEAM'] || '').trim();
                if (!whiteTeamRaw || !darkTeamRaw) return;
                
                const whiteTeam = cleanTeamName(whiteTeamRaw);
                const darkTeam = cleanTeamName(darkTeamRaw);
                
                allTeams.add(whiteTeam.name);
                allTeams.add(darkTeam.name);
                venues.add((row.LOCATION || '').trim());
                
                // Parse scores from the S columns (S = white team score, S2 = dark team score)
                const whiteScore = (row.S && row.S.trim() !== '') ? parseInt(row.S.trim()) : null;
                const darkScore = (row.S2 && row.S2.trim() !== '') ? parseInt(row.S2.trim()) : null;
                
                matches.push({
                    match_id: index + 1,
                    date: (row.DATE || '').trim(),
                    time: (row.TIME || '').trim(),
                    venue: (row.LOCATION || '').trim(),
                    white_team: whiteTeam,
                    dark_team: darkTeam,
                    white_score: whiteScore,
                    dark_score: darkScore,
                    status: (whiteScore !== null && darkScore !== null) ? 'COMPLETED' : 'SCHEDULED',
                    phase: determineMatchPhase(row.COMMENTS || '', whiteTeamRaw, darkTeamRaw),
                    comments: (row.COMMENTS || '').trim()
                });
            });

            // Filter actual teams (remove placeholders)
            const actualTeams = Array.from(allTeams).filter(team => 
                !team.includes('st ') && !team.endsWith(' -') && team !== ''
            );

            // Extract pools based on actual tournament structure from CSV data
            const pools = {
                A: ['SD SHORES BLACK', 'POWAY VALLEY', 'SOCAL'],
                B: ['NORTH IRVINE', 'ROSE BOWL', 'SD SHORES GOLD'], 
                C: ['CARLSBAD', 'CHAWP', 'CLOVIS', 'TEMPLE CITY'],
                D: ['THUNDER', 'COMMERCE', 'SUPREME', 'KERN PREMIER']
            };

            return {
                teams: actualTeams.sort(),
                venues: Array.from(venues).filter(v => v).sort(),
                pools: pools,
                matches: matches
            };
        }

        // Display pools
        function displayPools(pools) {
            const container = document.getElementById('pools-container');
            container.innerHTML = '';

            Object.entries(pools).forEach(([poolName, teams]) => {
                if (teams.length > 0) {
                    const standingsTable = document.createElement('div');
                    standingsTable.className = 'standings-table';
                    
                    standingsTable.innerHTML = `
                        <h3>Pool ${poolName}</h3>
                        <div class="standings-list">
                            ${teams.map((team, index) => `
                                <div class="standing-item clickable-pool-team" data-team="${team}" style="cursor: pointer; transition: background-color 0.2s;">
                                    <span class="position">${poolName}${index + 1}</span>
                                    <span class="team-name">${team}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    container.appendChild(standingsTable);
                }
            });
        }

        // Display matches in table format
        function displayMatches(matches) {
            const tbody = document.getElementById('matches-tbody');
            tbody.innerHTML = '';

            // Sort matches by match_id to show in chronological order
            matches.sort((a, b) => a.match_id - b.match_id);

            matches.forEach(match => {
                const row = document.createElement('tr');
                
                // Determine status color
                let statusColor = '#1976d2'; // Blue for scheduled
                let statusText = 'SCHEDULED';
                if (match.status === 'COMPLETED') {
                    statusColor = '#388e3c'; // Green for completed
                    statusText = 'COMPLETED';
                } else if (match.phase.toLowerCase().includes('final')) {
                    statusColor = '#d32f2f'; // Red for finals
                }

                // Determine if teams are placeholders
                const isPlaceholder = match.white_team.name.includes(' -') || match.dark_team.name.includes(' -');
                
                // Determine winner and format team names
                let whiteTeamStyle = `padding: 8px; border: 1px solid #ddd; text-align: left; ${isPlaceholder ? 'font-style: italic; color: #666;' : ''}`;
                let darkTeamStyle = `padding: 8px; border: 1px solid #ddd; text-align: left; ${isPlaceholder ? 'font-style: italic; color: #666;' : ''}`;
                
                if (match.status === 'COMPLETED' && match.white_score !== null && match.dark_score !== null) {
                    if (match.white_score > match.dark_score) {
                        // White team wins - make bold
                        whiteTeamStyle += '; font-weight: bold; color: #2e7d32;';
                    } else if (match.dark_score > match.white_score) {
                        // Dark team wins - make bold
                        darkTeamStyle += '; font-weight: bold; color: #2e7d32;';
                    }
                }
                
                // Format score display
                let scoreDisplay = '- vs -';
                if (match.status === 'COMPLETED' && match.white_score !== null && match.dark_score !== null) {
                    scoreDisplay = `<span style="font-weight: bold; color: #d32f2f;">${match.white_score}</span> - <span style="font-weight: bold; color: #d32f2f;">${match.dark_score}</span>`;
                }
                
                row.innerHTML = `
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">${match.match_id}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${match.date}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center;" id="time-cell-${match.match_id}">
                        <!-- Calendar button will be inserted here -->
                    </td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${getVenueLink(match.venue)}</td>
                    <td style="${whiteTeamStyle}">${match.white_team.code ? match.white_team.code + ' - ' : ''}${match.white_team.name}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: bold; font-size: 1.1rem;">${scoreDisplay}</td>
                    <td style="${darkTeamStyle}">${match.dark_team.code ? match.dark_team.code + ' - ' : ''}${match.dark_team.name}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center; background: #f8f9ff; color: #0077be; font-weight: 500;">${match.phase}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">
                        <span style="display: inline-block; width: 8px; height: 8px; background: ${statusColor}; border-radius: 50%; margin-right: 6px;"></span>
                        <span style="font-size: 0.9rem; color: ${statusColor};">${statusText}</span>
                    </td>
                `;

                // Highlight key matches
                if (match.comments && (match.comments.includes('1st') || match.comments.includes('3rd') || match.comments.includes('5th'))) {
                    row.style.background = 'linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%)';
                    row.style.border = '2px solid #f39c12';
                }

                // Highlight San Diego Shores teams
                if (match.white_team.name.includes('SHORES') || match.dark_team.name.includes('SHORES')) {
                    row.style.background = 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)';
                    row.style.border = '2px solid #2196f3';
                }

                tbody.appendChild(row);
                
                // Add calendar button after row is added to DOM
                const timeCell = document.getElementById(`time-cell-${match.match_id}`);
                if (timeCell) {
                    // Format match data for calendar function
                    const calendarMatchData = {
                        date: match.date,
                        time: match.time,
                        venue: match.venue,
                        team1: match.white_team.name,
                        team2: match.dark_team.name,
                        game_number: match.match_id
                    };
                    
                    const calendarButton = createCalendarButton(calendarMatchData, {
                        tournamentName: 'US Club Championship 16U',
                        websiteSource: 'SD Shores Tournament Website'
                    });
                    timeCell.appendChild(calendarButton);
                }
            });
        }

        // Load and display tournament data
        function loadTournamentData() {
            try {
                const csvRows = parseCSV(csvData);
                tournamentData = processTournamentData(csvRows);
                
                // Update stats
                document.getElementById('team-count').textContent = tournamentData.teams.length;
                document.getElementById('match-count').textContent = tournamentData.matches.length;
                document.getElementById('venue-count').textContent = tournamentData.venues.length;
                
                // Display data
                displayPools(tournamentData.pools);
                displayMatches(tournamentData.matches);
                
            } catch (error) {
                console.error('Error loading tournament data:', error);
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = `Error loading tournament data: ${error.message}`;
            }
        }

        // Function to convert venue names to links
        function getVenueLink(venue) {
            const venueLinks = {
                'RIVERSIDE POLY #1': '<a href="pools.html#riverside-poly" style="color: #0077be; text-decoration: none; font-weight: bold;">RIVERSIDE POLY #1</a>',
                'RIVERSIDE POLY #2': '<a href="pools.html#riverside-poly" style="color: #0077be; text-decoration: none; font-weight: bold;">RIVERSIDE POLY #2</a>',
                'RAMONA HS': '<a href="pools.html#ramona" style="color: #0077be; text-decoration: none; font-weight: bold;">RAMONA HS</a>',
                'NORCO HS': '<a href="pools.html#norco" style="color: #0077be; text-decoration: none; font-weight: bold;">NORCO HS</a>',
                'CHINO HILLS HS': '<a href="pools.html#chino-hills" style="color: #0077be; text-decoration: none; font-weight: bold;">CHINO HILLS HS</a>'
            };
            
            return venueLinks[venue] || venue;
        }

        // Function to extract clean team name (remove prefixes like "A1 -", "E1 -1st A -", etc.)
        function extractCleanTeamName(fullTeamName) {
            if (!fullTeamName) return 'Unknown';
            
            // Handle various prefix patterns:
            // "A1 - TEAM" -> "TEAM"
            // "E1 -1st A - TEAM" -> "TEAM" 
            // "M1 - 1st E - TEAM" -> "TEAM"
            const patterns = [
                /^[A-Z]+\d+\s*-\s*\d+\w+\s+[A-Z]+\s*-\s*(.+)$/, // "E1 -1st A - TEAM"
                /^[A-Z]+\d+\s*-\s*\d+\w+\s+[A-Z]+\d+\s*-\s*(.+)$/, // "M1 - 1st E1 - TEAM"  
                /^[A-Z]+\d+\s*-\s*(.+)$/, // "A1 - TEAM"
                /^.+\s+-\s+(.+)$/ // Generic "PREFIX - TEAM"
            ];
            
            for (const pattern of patterns) {
                const match = fullTeamName.trim().match(pattern);
                if (match) {
                    return match[1].trim();
                }
            }
            
            // If no pattern matches, return the original name
            return fullTeamName.trim();
        }

        // Function to show matches for a pool team
        function showPoolTeamMatches(teamName) {
            if (!tournamentData || !tournamentData.matches) {
                console.error('Tournament data not available');
                return;
            }

            // Filter matches for this team (handle team names with prefixes like "A1 - TEAM", "E1 -1st A - TEAM", etc.)
            const teamMatches = tournamentData.matches.filter(match => {
                const whiteTeamName = match.white_team.name.replace(/\s+/g, ' ').trim();
                const darkTeamName = match.dark_team.name.replace(/\s+/g, ' ').trim();
                const searchTeamName = teamName.replace(/\s+/g, ' ').trim();
                
                // Check if team name appears at the end (after any prefixes)
                return whiteTeamName.endsWith(searchTeamName) || darkTeamName.endsWith(searchTeamName) ||
                       whiteTeamName === searchTeamName || darkTeamName === searchTeamName;
            });

            if (teamMatches.length === 0) {
                console.log('Available team names in matches:', tournamentData.matches.map(m => [m.white_team.name, m.dark_team.name]));
                console.log('Searching for:', teamName);
                alert(`No matches found for ${teamName}. Check console for debug info.`);
                return;
            }

            // Create and show modal
            createTeamMatchesModal(teamName, teamMatches);
        }

        // Function to create team matches modal
        function createTeamMatchesModal(teamName, matches) {
            const modal = document.getElementById('teamMatchesModal');
            const modalTeamName = document.getElementById('modalTeamName');
            const teamMatchesList = document.getElementById('teamMatchesList');

            // Set team name in modal header
            modalTeamName.textContent = `${teamName} - Tournament Matches`;

            // Sort matches by match_id (chronological order)
            matches.sort((a, b) => a.match_id - b.match_id);

            // Group matches by phase
            const groupedMatches = {};
            matches.forEach(match => {
                const phase = match.phase;
                if (!groupedMatches[phase]) {
                    groupedMatches[phase] = [];
                }
                groupedMatches[phase].push(match);
            });

            // Generate matches HTML
            let matchesHTML = '';
            
            Object.entries(groupedMatches).forEach(([phase, phaseMatches]) => {
                matchesHTML += `
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #0077be; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #0077be;">
                            ${phase} (${phaseMatches.length} match${phaseMatches.length > 1 ? 'es' : ''})
                        </h4>
                        <div style="display: grid; gap: 12px;">
                `;

                phaseMatches.forEach(match => {
                    // Check which team matches (handle prefixed names)
                    const whiteTeamName = match.white_team.name.replace(/\s+/g, ' ').trim();
                    const darkTeamName = match.dark_team.name.replace(/\s+/g, ' ').trim();
                    const searchTeamName = teamName.replace(/\s+/g, ' ').trim();
                    
                    const isTeam1 = whiteTeamName.endsWith(searchTeamName) || whiteTeamName === searchTeamName;
                    const isTeam2 = darkTeamName.endsWith(searchTeamName) || darkTeamName === searchTeamName;
                    
                    // Extract clean opponent name (remove prefixes)
                    let opponent;
                    if (isTeam1) {
                        opponent = extractCleanTeamName(match.dark_team.name);
                    } else if (isTeam2) {
                        opponent = extractCleanTeamName(match.white_team.name);
                    } else {
                        opponent = 'Unknown';
                    }
                    
                    // Get team and opponent scores
                    let teamScore = 'TBD';
                    let opponentScore = 'TBD';
                    if (match.status === 'COMPLETED' && match.white_score !== null && match.dark_score !== null) {
                        if (isTeam1) {
                            teamScore = match.white_score;
                            opponentScore = match.dark_score;
                        } else if (isTeam2) {
                            teamScore = match.dark_score;
                            opponentScore = match.white_score;
                        }
                    }
                    
                    const matchDate = match.date || 'TBD';
                    const matchTime = match.time || 'TBD';
                    const venue = getVenueLink(match.venue) || 'TBD';
                    
                    matchesHTML += `
                        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 15px; align-items: center;">
                                <div style="text-align: center; min-width: 60px;">
                                    <div style="font-size: 0.9rem; color: #666;">${matchDate}</div>
                                    <div style="font-size: 0.9rem; color: #666;">${matchTime}</div>
                                </div>
                                <div>
                                    <div style="font-weight: bold; margin-bottom: 5px;">
                                        <span style="color: ${(isTeam1 || isTeam2) ? '#0077be' : '#333'};">${teamName}</span>
                                        <span style="margin: 0 10px;">vs</span>
                                        <span style="color: #333;">${opponent}</span>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #666;">
                                        üìç ${venue}
                                    </div>
                                </div>
                                <div style="text-align: center; min-width: 80px;">
                                    <div style="font-size: 1.1rem; font-weight: bold; color: ${match.status === 'COMPLETED' ? '#d32f2f' : '#0077be'};">
                                        ${teamScore} - ${opponentScore}
                                    </div>
                                    <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                                        Game ${match.match_id}
                                    </div>
                                    <div style="font-size: 0.7rem; color: ${match.status === 'COMPLETED' ? '#388e3c' : '#1976d2'}; margin-top: 2px;">
                                        ${match.status}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                matchesHTML += `
                        </div>
                    </div>
                `;
            });

            // Add summary info at the top
            const summaryHTML = `
                <div style="background: linear-gradient(135deg, #0077be, #00a8cc); color: white; padding: 20px; border-radius: 8px; margin-bottom: 25px; text-align: center;">
                    <h3 style="margin: 0 0 10px 0;">${teamName}</h3>
                    <p style="margin: 0; opacity: 0.9;">Total Matches: ${matches.length} | Tournament: US Club Championship</p>
                </div>
            `;

            teamMatchesList.innerHTML = summaryHTML + matchesHTML;

            // Show modal
            modal.style.display = 'block';
        }

        // Function to set up event listeners after pools are loaded
        function setupTeamClickListeners() {
            const clickableTeams = document.querySelectorAll('.clickable-pool-team');
            clickableTeams.forEach(teamElement => {
                teamElement.addEventListener('click', function() {
                    const teamName = this.dataset.team;
                    showPoolTeamMatches(teamName);
                });
                
                // Add hover effect
                teamElement.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#e3f2fd';
                });
                teamElement.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '';
                });
            });
        }

        // Function to set up modal close functionality
        function setupModalCloseListeners() {
            const modal = document.getElementById('teamMatchesModal');
            const closeBtn = modal.querySelector('.close');

            // Close modal when X is clicked
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });

            // Close modal when clicking outside of it
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Close modal when Escape key is pressed
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && modal.style.display === 'block') {
                    modal.style.display = 'none';
                }
            });
        }



        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadTournamentData();
            
            // Set up modal close listeners
            setupModalCloseListeners();
            
            // Set up team click listeners after a short delay to ensure pools are loaded
            setTimeout(setupTeamClickListeners, 500);
            
            // Initialize collapsible functionality (matches script.js implementation)
            const collapsibles = document.querySelectorAll('.collapsible');
            collapsibles.forEach(collapsible => {
                collapsible.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;
                    content.classList.toggle('active');
                });
            });
        });
    </script>

    <!-- Team Matches Modal -->
    <div id="teamMatchesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTeamName">Team Matches</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="teamMatchesList"></div>
            </div>
        </div>
    </div>

    <script src="calendar.js"></script>
    <script src="script.js" defer></script>
</body>
</html>