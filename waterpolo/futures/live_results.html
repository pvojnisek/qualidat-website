<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Futures Super Finals 2025 - Live Results</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0077be 0%, #00a8cc 50%, #4fc3f7 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0077be, #00a8cc);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .title {
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 600;
        }

        .live-dot {
            width: 12px;
            height: 12px;
            background: #ff4757;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        .status-bar {
            background: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .status-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-loading {
            background: #fff3cd;
            color: #856404;
        }

        .status-success {
            background: #d1edff;
            color: #0c5460;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .refresh-info {
            font-size: 0.9rem;
            color: #6c757d;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .countdown {
            font-weight: 600;
            color: #0077be;
        }

        .data-container {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .match-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .match-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-left: 6px solid #0077be;
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        .match-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #0077be, #00a8cc, #4fc3f7);
        }

        .match-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
        }

        .match-card.shores-highlight {
            border-left-color: #ff6b35;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.05) 0%, rgba(255, 255, 255, 1) 20%);
        }

        .match-card.shores-highlight::before {
            background: linear-gradient(90deg, #ff6b35, #ffa726, #ffcc02);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .match-number {
            background: linear-gradient(135deg, #0077be, #00a8cc);
            color: white;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
            box-shadow: 0 3px 10px rgba(0, 119, 190, 0.3);
        }

        .match-card.shores-highlight .match-number {
            background: linear-gradient(135deg, #ff6b35, #ffa726);
            box-shadow: 0 3px 10px rgba(255, 107, 53, 0.3);
        }

        .match-status {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-live {
            background: #ff4757;
            color: white;
            animation: pulse 2s infinite;
        }

        .status-completed {
            background: #2ed573;
            color: white;
        }

        .status-upcoming {
            background: #ffa502;
            color: white;
        }

        .status-result {
            background: #5352ed;
            color: white;
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .team-info {
            flex: 1;
            min-width: 120px;
        }

        .team-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .team-name.shores-team {
            color: #ff6b35;
            text-shadow: 0 1px 3px rgba(255, 107, 53, 0.2);
        }

        .team-score {
            font-size: 2rem;
            font-weight: 800;
            color: #0077be;
        }

        .match-card.shores-highlight .team-score {
            color: #ff6b35;
        }

        .vs-divider {
            font-size: 1.2rem;
            font-weight: 600;
            color: #6c757d;
            margin: 0 15px;
        }

        .match-details {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #495057;
            border: 1px solid #e9ecef;
        }

        .match-time {
            font-weight: 600;
            color: #0077be;
            margin-bottom: 4px;
        }

        .match-venue {
            color: #6c757d;
            font-style: italic;
        }

        .raw-data {
            margin-top: 10px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 0.8rem;
            color: #6c757d;
            padding: 8px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 4px;
            word-break: break-all;
            display: none;
        }

        .show-raw {
            cursor: pointer;
            color: #0077be;
            font-size: 0.8rem;
            text-decoration: underline;
            margin-top: 8px;
            display: inline-block;
        }

        .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 60px;
            font-style: italic;
            font-size: 1.1rem;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .footer {
            background: #f8f9fa;
            padding: 20px 30px;
            border-top: 1px solid #e9ecef;
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: linear-gradient(135deg, #0077be, #00a8cc);
            color: white;
            padding: 12px 20px;
            border-radius: 15px;
            font-weight: 600;
            text-align: center;
            min-width: 120px;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2.2rem;
            }
            
            .match-grid {
                grid-template-columns: 1fr;
            }
            
            .match-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .status-bar {
                flex-direction: column;
                text-align: center;
            }
            
            .match-teams {
                flex-direction: column;
                text-align: center;
            }
            
            .vs-divider {
                margin: 10px 0;
            }
        }

        /* Floating Back Button Styles */
        .floating-back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 999;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 119, 190, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            text-decoration: none;
            opacity: 0;
            transform: translateY(-10px);
            animation: fadeInFloat 0.6s ease-out 0.5s forwards;
        }

        .floating-back-btn img {
            width: 70px;
            height: 70px;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .floating-back-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 30px rgba(0, 119, 190, 0.3);
            background: rgba(255, 255, 255, 1);
            border-color: rgba(0, 119, 190, 0.4);
            text-decoration: none;
        }

        .floating-back-btn:hover img {
            transform: scale(1.1);
        }

        @keyframes fadeInFloat {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Floating Back Button -->
    <a href="../index.html" class="floating-back-btn" id="floatingBackBtn">
        <img src="https://sdshores.org/sites/all/themes/jango/jango_sub/logo.png" alt="SD Shores Logo" />
    </a>
    <div class="container">
        <div class="header">
            <h1 class="title">üèÜ Futures Super Finals 2025</h1>
            <p class="subtitle">Live Tournament Results - Boys Division</p>
            <div class="live-indicator">
                <div class="live-dot"></div>
                <span>LIVE ‚Ä¢ Auto-refresh every 3 minutes</span>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-info">
                <div id="statusBadge" class="status-badge status-loading">
                    <span class="spinner"></span> Loading latest results...
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="matchCount">0</div>
                        <div class="stat-label">Latest Results</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="shoresCount">0</div>
                        <div class="stat-label">SD Shores Matches</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="lastUpdate">--:--</div>
                        <div class="stat-label">Last Update</div>
                    </div>
                </div>
            </div>
            <div class="refresh-info">
                <span>Next refresh in</span>
                <span class="countdown" id="countdown">--</span>
            </div>
        </div>

        <div class="data-container">
            <div id="matchGrid" class="match-grid">
                <div class="empty-state">
                    üîÑ Loading latest tournament results from Kahuna Events...<br>
                    <small style="margin-top: 10px; display: block;">Showing the most recent 15 matches with SD Shores teams highlighted</small>
                </div>
            </div>
        </div>

        <div class="footer">
            <div>Data source: <strong>feeds.kahunaevents.org/kahuna</strong></div>
            <div style="margin-top: 8px; font-size: 0.8rem;">
                Real-time tournament feed ‚Ä¢ CORS proxy enabled ‚Ä¢ SD Shores teams highlighted in <span style="color: #ff6b35; font-weight: bold;">orange</span>
            </div>
        </div>
    </div>

    <script>
        let matchCount = 0;
        let shoresCount = 0;
        let refreshInterval = null;
        let countdownInterval = null;
        let nextRefreshTime = 0;

        // CORS proxy configuration - use robust proxy system
        const KAHUNA_URL = 'https://feeds.kahunaevents.org/kahuna';
        const PROXIES = [
            { name: 'ThingProxy', url: 'https://thingproxy.freeboard.io/fetch/' },
            { name: 'AllOrigins', url: 'https://api.allorigins.win/raw?url=' },
            { name: 'CodeTabs', url: 'https://api.codetabs.com/v1/proxy/?quest=' }
        ];

        // SD Shores team detection patterns - more specific to avoid false positives
        const SHORES_PATTERNS = [
            /\bsd shores\b/i,
            /\bsan diego shores\b/i,
            /\bshores black\b/i,
            /\bshores gold\b/i,
            /\bshores white\b/i,
            /\bshores blue\b/i,
            /\bshores red\b/i
        ];

        async function loadLiveResults() {
            console.log('üîÑ Loading live tournament results...');
            updateStatus('loading', 'Fetching latest results...');

            try {
                const data = await fetchViaProxy();
                if (data) {
                    displayMatchResults(data);
                    updateStatus('success', 'Results loaded successfully');
                    updateLastRefreshTime();
                } else {
                    throw new Error('No data received from tournament feed');
                }
            } catch (error) {
                console.error('‚ùå Failed to load results:', error);
                updateStatus('error', 'Failed to load results');
                showError(error.message);
            }
        }

        async function fetchViaProxy() {
            for (const proxy of PROXIES) {
                try {
                    console.log(`üîÑ Trying ${proxy.name} for tournament data...`);
                    updateStatus('loading', `Connecting via ${proxy.name}...`);

                    const proxyUrl = proxy.name === 'ThingProxy' 
                        ? proxy.url + KAHUNA_URL
                        : proxy.url + encodeURIComponent(KAHUNA_URL);

                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000);

                    const response = await fetch(proxyUrl, {
                        signal: controller.signal,
                        mode: 'cors',
                        cache: 'no-cache'
                    });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const text = await response.text();
                    console.log(`‚úÖ ${proxy.name} successful, data length: ${text.length}`);
                    return text;

                } catch (error) {
                    console.warn(`‚ùå ${proxy.name} failed:`, error.message);
                    continue;
                }
            }
            return null;
        }

        function displayMatchResults(data) {
            const lines = data.split('\n').filter(line => line.trim());
            
            // Get the latest 15 lines for testing purposes
            const latestResults = lines.slice(-15).reverse(); // Most recent first
            
            matchCount = latestResults.length;
            shoresCount = 0;
            
            const matchGrid = document.getElementById('matchGrid');
            matchGrid.innerHTML = '';

            if (latestResults.length === 0) {
                matchGrid.innerHTML = '<div class="empty-state">üì≠ No tournament results available at this time</div>';
                return;
            }

            latestResults.forEach((line, index) => {
                const isShoresMatch = detectShoresTeam(line);
                if (isShoresMatch) shoresCount++;
                
                const matchCard = createMatchCard(line, index + 1, isShoresMatch);
                matchGrid.appendChild(matchCard);
            });

            // Update stats
            document.getElementById('matchCount').textContent = matchCount;
            document.getElementById('shoresCount').textContent = shoresCount;
        }

        function detectShoresTeam(line) {
            return SHORES_PATTERNS.some(pattern => pattern.test(line));
        }

        function createMatchCard(line, cardNumber, isShoresMatch) {
            const matchDiv = document.createElement('div');
            matchDiv.className = `match-card ${isShoresMatch ? 'shores-highlight' : ''}`;
            matchDiv.style.animationDelay = `${cardNumber * 0.1}s`;
            
            // Parse match data (basic parsing for display)
            const matchData = parseMatchLine(line);
            const matchStatus = detectMatchStatus(line);
            
            matchDiv.innerHTML = `
                <div class="match-header">
                    <span class="match-number">${isShoresMatch ? 'üåä ' : ''}Result #${cardNumber}</span>
                    ${matchStatus ? `<span class="match-status status-${matchStatus.type}">${matchStatus.label}</span>` : ''}
                </div>
                
                <div class="match-teams">
                    <div class="team-info">
                        <div class="team-name ${matchData.team1.isShores ? 'shores-team' : ''}">${matchData.team1.name}</div>
                        ${matchData.team1.score !== null ? `<div class="team-score">${matchData.team1.score}</div>` : ''}
                    </div>
                    <div class="vs-divider">VS</div>
                    <div class="team-info" style="text-align: right;">
                        <div class="team-name ${matchData.team2.isShores ? 'shores-team' : ''}">${matchData.team2.name}</div>
                        ${matchData.team2.score !== null ? `<div class="team-score">${matchData.team2.score}</div>` : ''}
                    </div>
                </div>
                
                <div class="match-details">
                    ${matchData.time ? `<div class="match-time">‚è∞ ${matchData.time}</div>` : ''}
                    ${matchData.venue ? `<div class="match-venue">üìç ${matchData.venue}</div>` : ''}
                    ${matchData.date ? `<div style="color: #6c757d;">üìÖ ${matchData.date}</div>` : ''}
                    ${matchData.division ? `<div style="color: #0077be; font-weight: 600;">üèÜ ${matchData.division}</div>` : ''}
                    ${matchData.placement ? `<div style="color: #ff6b35; font-weight: 600;">üéØ ${matchData.placement}</div>` : ''}
                    ${matchData.gameId ? `<div style="color: #6c757d; font-size: 0.8rem;">Game: ${matchData.gameId}</div>` : ''}
                </div>
                
                <span class="show-raw" onclick="toggleRawData(this)">Show raw data</span>
                <div class="raw-data">${escapeHtml(line)}</div>
            `;
            
            return matchDiv;
        }

        function parseMatchLine(line) {
            // Parse Kahuna Events format: HOT! RESULT DIVISION  DATE  VENUE  TIME  GAME_ID  TEAM1=SCORE1  TEAM2=SCORE2  PLACEMENT
            const result = {
                team1: { name: 'Team A', score: null, isShores: false },
                team2: { name: 'Team B', score: null, isShores: false },
                time: null,
                venue: null,
                division: null,
                date: null,
                gameId: null,
                placement: null,
                status: 'RESULT'
            };

            // Split by double spaces (field separator in Kahuna format)
            const fields = line.split(/\s{2,}/);
            
            if (fields.length >= 8) {
                // Field structure: [0]HOT! RESULT DIVISION [1]DATE [2]VENUE [3]TIME [4]GAME_ID [5]TEAM1=SCORE [6]TEAM2=SCORE [7]PLACEMENT
                
                // Parse division from first field
                const divisionMatch = fields[0].match(/RESULT\s+(.+)$/);
                if (divisionMatch) {
                    result.division = divisionMatch[1];
                }
                
                // Parse date (field 1)
                result.date = fields[1]?.trim();
                
                // Parse venue (field 2)
                result.venue = fields[2]?.trim();
                
                // Parse time (field 3)
                result.time = fields[3]?.trim();
                
                // Parse game ID (field 4)
                result.gameId = fields[4]?.trim();
                
                // Parse team 1 and score (field 5)
                const team1Match = fields[5]?.match(/^(.+?)=(.+)$/);
                if (team1Match) {
                    result.team1.name = team1Match[1].replace(/^[^-]+-/, '').trim(); // Remove prefix like "W#38-"
                    result.team1.score = team1Match[2];
                }
                
                // Parse team 2 and score (field 6)
                const team2Match = fields[6]?.match(/^(.+?)=(.+)$/);
                if (team2Match) {
                    result.team2.name = team2Match[1].replace(/^[^-]+-/, '').trim(); // Remove prefix like "W#40-"
                    result.team2.score = team2Match[2];
                }
                
                // Parse placement (field 7)
                result.placement = fields[7]?.trim();
                
                // Check if teams are Shores
                result.team1.isShores = detectShoresTeam(result.team1.name);
                result.team2.isShores = detectShoresTeam(result.team2.name);
                
                // Determine status from line
                if (line.includes('HOT!')) {
                    result.status = 'HOT';
                } else if (line.includes('LIVE')) {
                    result.status = 'LIVE';
                } else {
                    result.status = 'RESULT';
                }
            }

            return result;
        }

        function detectMatchStatus(line) {
            const upperLine = line.toUpperCase();
            
            // Check if this is today's match for HOT! label
            const today = new Date();
            const todayString = today.toLocaleDateString('en-US', { 
                day: 'numeric', 
                month: 'short' 
            }).replace(' ', '-'); // Format: "25-Jun"
            
            const isToday = line.includes(todayString);
            
            if (upperLine.includes('HOT!') && isToday) {
                return { type: 'live', label: 'HOT! üî•' };
            }
            if (upperLine.includes('LIVE') || upperLine.includes('PLAYING')) {
                return { type: 'live', label: 'LIVE' };
            }
            if (upperLine.includes('FINAL')) {
                return { type: 'completed', label: 'FINAL' };
            }
            if (upperLine.includes('UPCOMING') || upperLine.includes('SCHEDULED')) {
                return { type: 'upcoming', label: 'UPCOMING' };
            }
            // Return null for no status badge - removes RESULT tags
            return null;
        }

        function toggleRawData(element) {
            const rawData = element.nextElementSibling;
            const isVisible = rawData.style.display === 'block';
            
            rawData.style.display = isVisible ? 'none' : 'block';
            element.textContent = isVisible ? 'Show raw data' : 'Hide raw data';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateStatus(type, message) {
            const badge = document.getElementById('statusBadge');
            badge.className = `status-badge status-${type}`;
            badge.innerHTML = type === 'loading' 
                ? `<span class="spinner"></span> ${message}`
                : message;
        }

        function showError(message) {
            const matchGrid = document.getElementById('matchGrid');
            matchGrid.innerHTML = `
                <div class="empty-state">
                    ‚ùå Error loading tournament results<br>
                    <small style="margin-top: 10px; display: block; color: #dc3545;">${escapeHtml(message)}</small>
                    <small style="margin-top: 10px; display: block;">Will retry automatically in next refresh cycle...</small>
                </div>
            `;
        }

        function updateLastRefreshTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastUpdate').textContent = timeString;
        }

        function startRefreshCycle() {
            // Set next refresh time (3 minutes)
            nextRefreshTime = Date.now() + (3 * 60 * 1000);
            
            // Clear existing intervals
            if (refreshInterval) clearInterval(refreshInterval);
            if (countdownInterval) clearInterval(countdownInterval);
            
            // Start refresh cycle every 3 minutes
            refreshInterval = setInterval(loadLiveResults, 3 * 60 * 1000);
            
            // Start countdown display
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        function updateCountdown() {
            const remaining = Math.max(0, nextRefreshTime - Date.now());
            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            
            if (remaining > 0) {
                document.getElementById('countdown').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            } else {
                document.getElementById('countdown').textContent = 'Refreshing...';
                nextRefreshTime = Date.now() + (3 * 60 * 1000);
            }
        }

        // Initialize the page
        window.addEventListener('load', () => {
            console.log('üöÄ Futures Super Finals Live Results page loaded');
            loadLiveResults();
            startRefreshCycle();
        });

        // Handle page visibility changes for better performance
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                // Page became visible, refresh if it's been more than 1 minute
                const timeSinceRefresh = Date.now() - (nextRefreshTime - (3 * 60 * 1000));
                if (timeSinceRefresh > 60000) {
                    console.log('üîÑ Page visible again, refreshing results...');
                    loadLiveResults();
                    startRefreshCycle();
                }
            }
        });
    </script>
</body>
</html>